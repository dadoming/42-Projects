Tutorial: https://github.com/codesshaman/inception/tree/main
Tutorial MariaDB: https://mariadb.com/kb/en/mariadb-basics/
!! Everytime something works, save it on the snapshots in the VM: https://github.com/codesshaman/inception/blob/main/03_CLOUD_STORAGE.md

# Step-by-Step

## Installation

-> Install VM with Ubuntu 22.04 LTS
-> Install code make docker docker-compose firefox
-> Allow ports 443 and 80 in ufw:
    ufw status
    if (inactive)
        ufw enable
    ufw allow 80
    ufw allow 443
     
-> $> shutdown now

-> Enable port forwarding to ports 80, 443:
    settings -> network -> advanced -> port forwarding
    add HTTP 80 80
    add HTTPS 443 443

-> Start machine again

-> Add user to the docker group:
    groups dadoming
    sudo usermod -aG docker dadoming
    groups dadoming
Now docker commands can be written without sudo

## Start Project

-> Create project directories and files neccessary for inception according to subject

-> Install mkcert -> https://github.com/FiloSottile/mkcert :
-> Install self-signed SSL certificate (mkcert) or not (this is supposed to be generated and
inserted into the .env file in the execution of the dockerfile of nginx)

Subject: "For obvious security reasons, any credentials, API keys, env
variables etc... must be saved locally in a .env file and ignored by
git. Publicly stored credentials will lead you directly to a failure
of the project"

-> Make nginx run a .sh as an entrypoint in the dockerfile file that creates the env variables
(and key? or is key supposed to be generated by the dockerfile)

$> curl -s https://api.github.com/repos/FiloSottile/mkcert/releases/latest| grep browser_download_url  | grep linux-amd64 | cut -d '"' -f 4 | wget -qi -
$> mv mkcert-v*-linux-amd64 mkcert
$> chmod a+x mkcert
$> sudo mv mkcert /usr/local/bin/
$> mkcert --version
v1.4.4

-> Add dadoming.42.fr to the /etc/hosts file:
$>sudo nano /etc/hosts
127.0.0.1       dadoming.42.fr localhost
127.0.1.1       dadoming

-> Obtain certificate:
$> cd srcs/requirements/tools/
$> mkcert dadoming.42.fr
Created a new local CA 💥
Note: the local CA is not installed in the system trust store.
Note: the local CA is not installed in the Firefox and/or Chrome/Chromium trust store.
Run "mkcert -install" for certificates to be trusted automatically ⚠️

Created a new certificate valid for the following names 📜
 - "dadoming.42.fr"

The certificate is at "./dadoming.42.fr.pem" and the key at "./dadoming.42.fr-key.pem" ✅

It will expire on 26 December 2025 🗓

$> mv dadoming.42.fr-key.pem dadoming.42.fr.key
$> mv dadoming.42.fr.pem dadoming.42.fr.crt

Para testar o que ja temos:

Create html file in srcs/public/html/index.html :
<!DOCTYPE html>
<html>
<head>
    <title>Hello World</title>
</head>
<body>
    <h1>Hello</h1>
</body>
</html>


docker-compose.yml:
version: '3'

services:
  nginx:
    image: nginx:stable-alpine
    volumes:
      - ./requirements/nginx/conf/:/etc/nginx/conf.d/
      - ./public:/var/www/public/
      - /home/${USER}/42-Projects/inception/srcs/requirements/tools:/etc/nginx/ssl/
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    container_name: simple_nginx_html

nginx/conf/nginx.conf:
server {
    listen      80;
    listen      443 ssl;

    server_name  dadoming.42.fr www.dadoming.42.fr;
    root    /var/www/public/html;

    ssl_certificate     /etc/nginx/ssl/dadoming.42.fr.crt;
    ssl_certificate_key /etc/nginx/ssl/dadoming.42.fr.key;

    ssl_protocols            TLSv1.2 TLSv1.3;
    ssl_session_timeout 10m;
    keepalive_timeout 70;

    location / {
        try_files $uri $uri/ /index.html;
    }
}




